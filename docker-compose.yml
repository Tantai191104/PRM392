version: "3.8"

services:
  escrowservice:
    build:
      context: .
      dockerfile: EscrowService/Dockerfile
    image: tantai231204/prm392_escrowservice:latest
    container_name: prm392_escrowservice
    restart: always
    depends_on:
      - authservice
      - productservice
      - walletservice
    environment:
      ASPNETCORE_ENVIRONMENT: Production
      ASPNETCORE_URLS: http://+:5141
      MongoSettings__ConnectionString: mongodb+srv://tantai231204:tantai191104@cluster0.nlp7smo.mongodb.net/?appName=Cluster0
      MongoSettings__DatabaseName: PRM392EscrowDB
      JwtSettings__SecretKey: VGhpc0lzQVNlY3JldEtleU11c3RCZVN0cmluZ0ZvckpXVFNpZ25pbmcxMjM0
      JwtSettings__Issuer: PRM392AuthService
      JwtSettings__Audience: PRM392Clients
      ExternalServices__AuthService__BaseUrl: http://authservice:5133
      ExternalServices__ProductService__BaseUrl: http://productservice:5137
      ExternalServices__WalletService__BaseUrl: http://walletservice:5150
    ports:
      - "5141:5141"
    networks:
      - prm392_network
  walletservice:
    build:
      context: .
      dockerfile: WalletService/Dockerfile
    image: tantai231204/prm392_walletservice:latest
    container_name: prm392_walletservice
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Production
      ASPNETCORE_URLS: http://+:5150
      MongoDbSettings__ConnectionString: mongodb+srv://tantai231204:tantai191104@cluster0.nlp7smo.mongodb.net/?appName=Cluster0
      MongoDbSettings__DatabaseName: PRM392WalletDB
    ports:
      - "5150:5150"
    networks:
      - prm392_network
  authservice:
    build:
      context: .
      dockerfile: AuthService/Dockerfile
    image: tantai231204/prm392_authservice:latest
    container_name: prm392_authservice
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Production
      ASPNETCORE_URLS: http://+:5133
      MongoSettings__ConnectionString: mongodb+srv://tantai231204:tantai191104@cluster0.nlp7smo.mongodb.net/?appName=Cluster0
      MongoSettings__DatabaseName: PRM392AuthDB
      JwtSettings__SecretKey: VGhpc0lzQVNlY3JldEtleU11c3RCZVN0cmluZ0ZvckpXVFNpZ25pbmcxMjM0
      JwtSettings__Issuer: PRM392AuthService
      JwtSettings__Audience: PRM392Clients
      ExternalServices__WalletService__BaseUrl: http://walletservice:5150
    ports:
      - "5133:5133"
    networks:
      - prm392_network

  productservice:
    build:
      context: .
      dockerfile: ProductService/Dockerfile
    image: tantai231204/prm392_productservice:latest
    container_name: prm392_productservice
    restart: always
    depends_on:
      - authservice
      - walletservice
    environment:
      ASPNETCORE_ENVIRONMENT: Production
      ASPNETCORE_URLS: http://+:5137
      MongoSettings__ConnectionString: mongodb+srv://tantai231204:tantai191104@cluster0.nlp7smo.mongodb.net/?appName=Cluster0
      MongoSettings__DatabaseName: PRM392ProductDB
      JwtSettings__SecretKey: VGhpc0lzQVNlY3JldEtleU11c3RCZVN0cmluZ0ZvckpXVFNpZ25pbmcxMjM0
      JwtSettings__Issuer: PRM392AuthService
      JwtSettings__Audience: PRM392Clients
      ExternalServices__WalletService__BaseUrl: http://walletservice:5150
    ports:
      - "5137:5137"
    networks:
      - prm392_network

  orderservice:
    build:
      context: .
      dockerfile: OrderService/Dockerfile
    image: tantai231204/prm392_orderservice:latest
    container_name: prm392_orderservice
    restart: always
    depends_on:
      - authservice
      - productservice
      - walletservice
    environment:
      ASPNETCORE_ENVIRONMENT: Production
      ASPNETCORE_URLS: http://+:5139
      MongoSettings__ConnectionString: mongodb+srv://tantai231204:tantai191104@cluster0.nlp7smo.mongodb.net/?appName=Cluster0
      MongoSettings__DatabaseName: PRM392OrderDB
      JwtSettings__SecretKey: VGhpc0lzQVNlY3JldEtleU11c3RCZVN0cmluZ0ZvckpXVFNpZ25pbmcxMjM0
      JwtSettings__Issuer: PRM392AuthService
      JwtSettings__Audience: PRM392Clients
      ExternalServices__AuthService__BaseUrl: http://authservice:5133
      ExternalServices__ProductService__BaseUrl: http://productservice:5137
      ExternalServices__WalletService__BaseUrl: http://walletservice:5150
    ports:
      - "5139:5139"
    networks:
      - prm392_network

  mediaservice:
    build:
      context: .
      dockerfile: MediaService/Dockerfile
    image: tantai231204/prm392_mediaservice:latest
    container_name: prm392_mediaservice
    restart: always
    depends_on:
      - authservice
    environment:
      ASPNETCORE_ENVIRONMENT: Production
      ASPNETCORE_URLS: http://+:5140
      MongoSettings__ConnectionString: mongodb+srv://tantai231204:tantai191104@cluster0.nlp7smo.mongodb.net/?appName=Cluster0
      MongoSettings__DatabaseName: PRM392MediaDB
      JwtSettings__SecretKey: VGhpc0lzQVNlY3JldEtleU11c3RCZVN0cmluZ0ZvckpXVFNpZ25pbmcxMjM0
      JwtSettings__Issuer: PRM392AuthService
      JwtSettings__Audience: PRM392Clients
      Storage__UploadPath: /app/uploads
      Storage__BaseUrl: http://mediaservice:5140
      Storage__MaxFileSizeMB: 10
      ExternalServices__WalletService__BaseUrl: http://walletservice:5150
    ports:
      - "5140:5140"
    volumes:
      - media_uploads:/app/uploads
    networks:
      - prm392_network

  chatservice:
    build:
      context: .
      dockerfile: ChatService/Dockerfile
    image: tantai231204/prm392_chatservice:latest
    container_name: prm392_chatservice
    restart: always
    depends_on:
      - authservice
    environment:
      ASPNETCORE_ENVIRONMENT: Production
      ASPNETCORE_URLS: http://+:5142
      MongoSettings__ConnectionString: mongodb+srv://tantai231204:tantai191104@cluster0.nlp7smo.mongodb.net/?appName=Cluster0
      MongoSettings__DatabaseName: PRM392ChatDB
      JwtSettings__SecretKey: VGhpc0lzQVNlY3JldEtleU11c3RCZVN0cmluZ0ZvckpXVFNpZ25pbmcxMjM0
      JwtSettings__Issuer: PRM392AuthService
      JwtSettings__Audience: PRM392Clients
    ports:
      - "5142:5142"
    networks:
      - prm392_network

  apigateway:
    build:
      context: .
      dockerfile: APIGateway/Dockerfile
    image: tantai231204/prm392_apigateway:latest
    container_name: prm392_apigateway
    restart: always
    depends_on:
      - authservice
      - productservice
      - orderservice
      - mediaservice
      - chatservice
      - walletservice
    environment:
      ASPNETCORE_ENVIRONMENT: Production
      ASPNETCORE_URLS: http://+:5016
      JwtSettings__SecretKey: VGhpc0lzQVNlY3JldEtleU11c3RCZVN0cmluZ0ZvckpXVFNpZ25pbmcxMjM0
      JwtSettings__Issuer: PRM392AuthService
      JwtSettings__Audience: PRM392Clients
      ExternalServices__WalletService__BaseUrl: http://walletservice:5150
    volumes:
      - ./APIGateway/appsettings.json:/app/appsettings.json:ro
    ports:
      - "5000:5016"
    networks:
      - prm392_network

volumes:
  media_uploads:

networks:
  prm392_network:
    driver: bridge
